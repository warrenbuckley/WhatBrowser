@using System.Net
@{
    ViewBag.Title = "What Browser";
}

@functions {
    string reverseIP(string ip)
    {
        if (string.IsNullOrEmpty(ip)) return ip;

        return string.Empty;
        //return Dns.GetHostByAddress(ip).HostName ?? ip;
    }    
}

<!DOCTYPE html>
<html  class="no-js">
<head>
    <meta charset="utf-8">
    <title>What Browser</title>

    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300|Pacifico' rel='stylesheet' type='text/css' />
    <link href="~/Content/styles.css"  rel="stylesheet" type="text/css" />
    <script src="~/Scripts/jquery-1.8.2.min.js"></script>
    <script src="~/Scripts/modernizr-2.6.2.js" type="text/javascript"></script>


<script>

    //Wait until DOM ready
    $(document).ready(function () {

        //Screen/monitor size
        var screenHeight    = window.screen.height;
        var screenWidth     = window.screen.width;
        console.log("Screen Res: " + screenHeight + " * " + screenWidth);

        //Update DOM elements
        $("#screenHeight").text(screenHeight);
        $("#screenWidth").text(screenWidth);
        
        //Viewport
        var viewHeight  = window.innerHeight;
        var viewWidth = window.innerWidth;

        $("#viewHeight").text(viewHeight);
        $("#viewWidth").text(viewWidth);

        console.log("View Res: " + viewHeight + " * " + viewWidth);

        //TODO: On window resize update val's of viewport window


        //Are cookies enabled?
        $("#mmmCookies").text(navigator.cookieEnabled);
        
        //Device Pixel Ratio
        $("#pixelRatio").text(window.devicePixelRatio);


        //Modernizr Stuff
        //Write out Modernizr Version to DOM
        $("#modernizrVersion").text(Modernizr._version);

        //Exclude list
        var excludeList = ['addTest', '_version', '_prefixes', '_domPrefixes', '_cssomPrefixes', 'mq', 'hasEvent', 'testProp', 'testAllProps', 'testStyles', 'prefixed'];

        //String to store HTML in
        var strHTML = "";

        //Lists out most true/false tests
        for (var test in Modernizr) {

            //Check we can not find the item in the exclude list array
            if ($.inArray(test, excludeList) == -1) {
                var obj = Modernizr[test];

                strHTML += "<h2 data-test-value='"+ obj + "'>" + test + ": " + obj + "</h2>";

                console.log(test + " = " + obj);

                //If obj has child object (input & inputtypes)            
                for (var prop in obj) {
                    if (obj.hasOwnProperty(prop)) {

                        strHTML += "<h3 data-test-value='" + obj[prop] + "'>" + prop + ": " + obj[prop] + "</h3>";

                        console.log(prop + " = " + obj[prop]);
                    }
                }
            }
        }

        //Write out test results to DIV
        $("#modernizrTests").html(strHTML);

    });
</script>

</head>
    <body>
        <h1>What Browser</h1>

        <h2>Browser: @Request.Browser.Browser @Request.Browser.Version</h2>
        <h2>Layout Engine: @Request.Browser.Capabilities["layoutEngine"] @Request.Browser.Capabilities["layoutEngineVersion"]</h2>
        <h2>Platform: @Request.Browser.Platform</h2>
        <h2>Browser Languages: @Request.Headers["Accept-Language"]</h2>

        <h2>Javascript Version: @Request.Browser["JavaScriptVersion"]</h2>
        <noscript>
            <h2>JavaScript Enabled: False</h2>
        </noscript>

        <h2>Cookies Enabled: <span id="mmmCookies"></span></h2>


        <h2>IP: @Request.UserHostAddress</h2>
        <h2>ISP: @reverseIP(Request.UserHostAddress)</h2>

        <h2>Screen Bit Depth: @Request.Browser.ScreenBitDepth</h2>

        <h2>Screen Pixels Height: <span id="screenHeight"></span></h2>
        <h2>Screen Pixels Height: <span id="screenWidth"></span></h2>

        <h2>View Port Height: <span id="viewHeight"></span></h2>
        <h2>View Port Width: <span id="viewWidth"></span></h2>

        <h2>Orientation: <span id="orientation"></span></h2>
        <h2>Device Pixel Ratio: <span id="pixelRatio"></span></h2>

        @if (Request.Browser.IsMobileDevice)
        {
            <h2>Mobile: @Request.Browser.MobileDeviceManufacturer @Request.Browser.MobileDeviceModel</h2>
        }

        <h2>User Agent:</h2>
        <textarea style="width:99%;">@Request.UserAgent</textarea>

        <hr />

        <h2>Modernizr Tests - Version <span id="modernizrVersion"></span></h2>
        <div id="modernizrTests"></div>

        <hr />

        <h4>TODO </h4>
        <ul>
            <li>Email these results (Form)</li>
        </ul>
    </body>
</html>